<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drug Matching Activity</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
}

.container {
  max-width: 900px;
  margin: 15px auto;
  background: #ffffff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

h2, h3 {
  text-align: center;
  color: #333;
  margin: 10px 0;
}

h2 {
  font-size: 24px;
  color: #667eea;
}

h3 {
  font-size: 18px;
  color: #666;
  font-weight: 500;
}

.hidden {
  display: none;
}

input, button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 10px;
  box-sizing: border-box;
}

input {
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  transition: border-color 0.3s;
}

input:focus {
  outline: none;
  border-color: #667eea;
}

button {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

button:active {
  transform: translateY(1px);
}

.timer {
  text-align: center;
  font-weight: bold;
  margin-bottom: 20px;
  font-size: 20px;
  color: #667eea;
  background: #f0f4ff;
  padding: 12px;
  border-radius: 8px;
}

.match-row {
  display: flex;
  flex-wrap: wrap;
  margin-bottom: 15px;
  align-items: stretch;
  background: #fafafa;
  border-radius: 10px;
  padding: 10px;
  gap: 10px;
}

.title {
  flex: 1 1 55%;
  padding: 10px;
  font-size: 15px;
  color: #333;
  display: flex;
  align-items: center;
  font-weight: 500;
}

.dropzone {
  flex: 1 1 40%;
  min-height: 60px;
  border: 2px dashed #ccc;
  border-radius: 10px;
  padding: 8px;
  background: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.dropzone.drag-over {
  background: #e8f0ff;
  border-color: #667eea;
  border-style: solid;
}

.pool {
  background: linear-gradient(135deg, #f5f7fa, #e8eef5);
  border-radius: 12px;
  padding: 15px;
  margin-top: 20px;
  border: 2px solid #e0e0e0;
}

.draggable {
  background: linear-gradient(135deg, #ffd166, #ffb347);
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  font-weight: 600;
  text-align: center;
  cursor: grab;
  touch-action: none;
  user-select: none;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  color: #333;
}

.draggable:active {
  cursor: grabbing;
  transform: scale(1.05);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.draggable.dragging {
  opacity: 0.7;
  transform: scale(1.1);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  position: fixed;
  pointer-events: none;
}

.result {
  text-align: center;
  font-weight: bold;
  margin-top: 20px;
  font-size: 18px;
  color: #333;
  padding: 15px;
  border-radius: 8px;
  background: #f0f4ff;
}

@media (max-width: 600px) {
  .match-row {
    flex-direction: column;
  }
  
  .title, .dropzone {
    flex: 1 1 100%;
  }
}
</style>
</head>

<body>

<div class="container">

<!-- NAME SCREEN -->
<div id="nameScreen">
  <h2>Enter Your Name</h2>
  <input id="traineeName" placeholder="Your name">
  <button onclick="startGame()">Start</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="hidden">
  <div class="timer">Time: <span id="time">0</span> sec</div>

  <div id="matches"></div>

  <h3>Drag the drugs into the correct boxes</h3>
  <div class="pool" id="pool"></div>

  <button onclick="submitAnswers()">Submit</button>
  <div class="result" id="result"></div>
</div>

</div>

<script>
// ---------------- DATA ----------------
const correct = {
  d1: "Vominore | Meclizine, pyridoxine",
  d2: "Bio-fiber",
  d3: "Duphalac",
  d4: "Resolor",
  d5: "Laxatrol | docusate, senna",
  d6: "Kapect"
};

const titles = [
  "Reduce nausea & vomiting during pregnancy",
  "Bulk forming laxative",
  "Safe laxative for elderly",
  "Used for chronic constipation",
  "Frequent use can cause cathartic colon",
  "Adsorb toxins & reduce fecal passage frequencies"
];

// ---------------- STATE ----------------
let timer = 0;
let interval;
let traineeName = "";

// ---------------- START ----------------
function startGame() {
  traineeName = document.getElementById("traineeName").value.trim();
  if (!traineeName) {
    alert("Please enter your name");
    return;
  }

  document.getElementById("nameScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");

  interval = setInterval(() => {
    timer++;
    document.getElementById("time").innerText = timer;
  }, 1000);

  loadGame();
}

// ---------------- LOAD GAME ----------------
function loadGame() {
  const matches = document.getElementById("matches");
  const pool = document.getElementById("pool");
  matches.innerHTML = "";
  pool.innerHTML = "";

  // Create drop zones
  titles.forEach((title, i) => {
    matches.innerHTML += `
      <div class="match-row">
        <div class="title">${title}</div>
        <div class="dropzone"
             data-id="d${i + 1}"
             ondragover="allowDrop(event)"
             ondrop="drop(event)">
        </div>
      </div>
    `;
  });

  // Create draggable cards (shuffled)
  shuffle(Object.entries(correct)).forEach(([id, text]) => {
    const div = document.createElement("div");
    div.className = "draggable";
    div.id = id;
    div.dataset.value = text;
    div.draggable = true;
    div.ondragstart = drag;
    div.innerText = text;
    pool.appendChild(div);
  });
}

// ---------------- DRAG & DROP ----------------
function allowDrop(e) {
  e.preventDefault();
}

function drag(e) {
  e.dataTransfer.setData("text/plain", e.target.id);
}

function drop(e) {
  e.preventDefault();
  const id = e.dataTransfer.getData("text/plain");
  const dragged = document.getElementById(id);

  if (e.target.classList.contains("dropzone") && e.target.children.length === 0) {
    e.target.appendChild(dragged);
  }
}

// Prevent page lock on mobile
document.addEventListener("dragover", e => e.preventDefault());
document.addEventListener("drop", e => e.preventDefault());

// ---------------- SUBMIT ----------------
// function submitAnswers() {
//   let score = 0;

//   document.querySelectorAll(".dropzone").forEach(zone => {
//     const expected = correct[zone.dataset.id];
//     const placed = zone.firstChild?.dataset.value;
//     if (placed === expected) score++;
//   });

//   if (score < 6) {
//     document.getElementById("result").innerText =
//       `You answered ${score} out of 6 correct. Try again.`;
//     return;
//   }

//   clearInterval(interval);
//   saveResult();
// }
// function submitAnswers() {
//   const zones = document.querySelectorAll(".dropzone");

//   // 1Ô∏è‚É£ Check all filled
//   for (let zone of zones) {
//     if (!zone.firstChild) {
//       document.getElementById("result").innerText =
//         "Please complete all matches before submitting.";
//       return;
//     }
//   }

//   // 2Ô∏è‚É£ Score
//   let score = 0;

//   zones.forEach(zone => {
//     const expected = correct[zone.dataset.id];
//     const placed = zone.firstChild.dataset.value;

//     if (placed === expected) score++;
//   });

//   // 3Ô∏è‚É£ Result
//   if (score < 6) {
//     document.getElementById("result").innerText =
//       `You answered ${score} out of 6 correct. Try again.`;
//     return;
//   }

//   clearInterval(interval);
//   saveResult();
// }


function submitAnswers() {
  const zones = document.querySelectorAll(".dropzone");
  const result = document.getElementById("result");

  // HARD GUARD ‚Äî nothing can crash after this
  if (zones.length !== 6) {
    result.innerText = "Internal error. Reload the page.";
    return;
  }

  for (let zone of zones) {
    if (!zone.firstElementChild) {
      result.innerText =
        "Please complete all matches before submitting.";
      return;
    }
  }

  let score = 0;

  for (let zone of zones) {
    const expected = correct[zone.dataset.id];
    const placedEl = zone.firstElementChild;

    if (!placedEl || !placedEl.dataset) continue;

    if (placedEl.dataset.value === expected) {
      score++;
    }
  }

  if (score !== 6) {
    result.innerText =
      `You answered ${score} out of 6 correct. Try again.`;
    return;
  }

  clearInterval(interval);
  saveResult();
}

// ---------------- SAVE ----------------
function saveResult() {
  fetch("https://script.google.com/macros/s/AKfycbywTBmYCeVtyqTU_Xqr1CDEFdo5Cj-9ianBNZdWT1avaMQUYHVof_dG2r29utcqivZHSw/exec", {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({
      name: traineeName,
      time: timer + " sec"
    })
  });

  document.getElementById("result").innerText =
    "üéâ All answers correct! Your result has been saved.";
}

// ---------------- UTILS ----------------
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script>

</body>
</html>
